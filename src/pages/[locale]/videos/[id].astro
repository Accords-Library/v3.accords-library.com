---
import AppEmptyLayout from "components/AppLayout/AppEmptyLayout.astro";
import Credits from "components/Credits.astro";
import DownloadButton from "components/DownloadButton.astro";
import RichText from "components/RichText/RichText.astro";
import TagGroups from "components/TagGroups.astro";
import VideoPlayer from "components/VideoPlayer.astro";
import { getI18n } from "src/i18n/i18n";
import { payload } from "src/shared/payload/payload-sdk";
import { fetchOr404 } from "src/utils/responses";

const { id } = Astro.params;
const video = await fetchOr404(() => payload.getVideoByID(id!));
if (video instanceof Response) {
  return video;
}

const { getLocalizedMatch } = await getI18n(Astro.locals.currentLocale);
const { translations, tagGroups, filename, url, credits } = video;

const { title, description } = getLocalizedMatch(translations);
---

{/* ------------------------------------------- HTML ------------------------------------------- */}

<AppEmptyLayout>
  <div id="container">
    <VideoPlayer video={video} />

    <div>
      <h1>{title}</h1>
      {description && <RichText content={description} />}
      <div>
        {tagGroups.length > 0 && <TagGroups {tagGroups} />}
        {credits.length > 0 && <Credits credits={credits} />}
      </div>
      <DownloadButton href={url} filename={filename} />
    </div>
  </div>
</AppEmptyLayout>

{/* ------------------------------------------- CSS -------------------------------------------- */}

<style>
  #container {
    display: flex;
    flex-direction: column;
    gap: 6em;
    align-items: center;

    > :global(video) {
      max-height: 60vh;
      max-width: 100%;
      height: auto;
      width: auto;
    }

    h1 {
      max-width: 35em;
    }

    & > div {
      display: flex;
      flex-direction: column;
      gap: 2em;
      align-items: start;

      & > div {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        gap: 2em 6em;
        width: 100%;
      }
    }
  }
</style>
